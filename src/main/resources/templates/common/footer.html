<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org" lang="ko">

<head>
	<meta charset="UTF-8">
	<title>Insert title here</title>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">


<style>
</style>	
</head>

<body >
<footer th:fragment="defaultFooter" class="footer-container">


<div >
 <!--	<table>
		<tbody>
			<tr>
				<td><img class="footerImage" th:name="타임라인" th:src="'https://bcuacdphgdfn24694507.cdn.ntruss.com/timelineList-free-icon-open-book-1375505.png'"/></td>
				<td><img class="footerImage" th:name="체크포인트" th:src="'https://bcuacdphgdfn24694507.cdn.ntruss.com/checkpoint_image.png'" /></td>
				<td><img class="footerImage" th:name="체크포인트" th:src="'https://bcuacdphgdfn24694507.cdn.ntruss.com/checkpoint_image.png'" /></td>
				<td><img class="footerImage" th:name="체크포인트" th:src="'https://bcuacdphgdfn24694507.cdn.ntruss.com/checkpoint_image.png'" /></td>
				<td><img class="footerImage" th:name="체크포인트" th:src="'https://bcuacdphgdfn24694507.cdn.ntruss.com/checkpoint_image.png'" /></td>
			</tr>
		</tbody>
	</table>
 -->

	<nav class="mobile-bottom-nav">
		<!-- <div class="mobile-bottom-nav__item mobile-bottom-nav__item--active"> -->
		<div class="mobile-bottom-nav__item" >
		    <div class="mobile-bottom-nav__item-content" th:classappend="${#request.requestURI.contains('/user/') && !#request.requestURI.contains('/user/getPersonalSecurityMenu') ? 'mobile-bottom-nav__item--active' : ''}" name="프로필">
		        <i class="material-icons">account_box</i>
		        Profile
		    </div>        
		</div>

		<div class="mobile-bottom-nav__item " >
			<div class="mobile-bottom-nav__item-content" th:classappend="${#request.requestURI.contains('/timeline/') ? 'mobile-bottom-nav__item--active' : ''}" name="타임라인">
				<i class="Medium material-icons">library_books</i>
				TimeLine
			</div>
		</div>
		
		<th:block th:if="${#request.requestURI.contains('/map')}">
			<div class="mobile-bottom-nav__item" >
				<div class="mobile-bottom-nav__item-content" name="체크포인트">
					<i class="large material-icons">album</i>
					Record
				</div>		
			</div>
		</th:block>
		<th:block th:if="${!#request.requestURI.contains('/map')}">
			<div class="mobile-bottom-nav__item" >
				<div class="mobile-bottom-nav__item-content" name="맵">
					<i class="large material-icons">map</i>
					map
				</div>		
			</div>
		</th:block>
		
		
		<div class="mobile-bottom-nav__item " >
			<div class="mobile-bottom-nav__item-content" th:classappend="${#request.requestURI.contains('/community/') ? 'mobile-bottom-nav__item--active' : ''}" name="커뮤니티">
				<i class="material-icons">insert_comment</i>
				Community
			</div>		
		</div>
		<div class="mobile-bottom-nav__item " >
			<div class="mobile-bottom-nav__item-content" th:classappend="${#request.requestURI.contains('/common/menu') || #request.requestURI.contains('/user/getPersonalSecurityMenu') ? 'mobile-bottom-nav__item--active' : ''}" name="메뉴">
				<i class="material-icons">list</i>
				Menu
			</div>		
		</div>
	</nav> 
	
	


<!-- <a href="#" th:text="체크포인트"></a> -->
 </div> 
<input type="hidden" th:name="recordUserIdOfFooter" th:value="${userId}"/>
<input type="hidden" th:name="latitudeOfFooter" th:value="'37.4923615'"/>
<input type="hidden" th:name="longitudeOfFooter" th:value="'127.0292881'"/>
<input type="hidden" th:name="checkpointAddressOfFooter" th:value="'서울시 강남구'"/>

	
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>	
<script type="text/javascript" th:src="@{//dapi.kakao.com/v2/maps/sdk.js(appkey=${apiKey})}"></script>
<script type="text/javascript">
$(function() {
		
	let userId = sessionStorage.getItem("userId");

	$("div[name='타임라인']").on("click", function() {
		self.location = "/timeline/getTimelineList?userId=user1";
	});
	
	$("div[name='체크포인트']").on("click", function() {
		
		if (navigator.geolocation) {
		    
		    // GeoLocation을 이용해서 접속 위치를 얻어옵니다
		    navigator.geolocation.getCurrentPosition(function(position) {
		        
		    	var lat = position.coords.latitude; // 위도
		    	var lon = position.coords.longitude; // 경도
		        console.log(lat);
		        console.log(lon);
		    	$('input[name="latitudeOfFooter"]').val(lat).trigger('change');
		        $('input[name="longitudeOfFooter"]').val(lon);
		      });
		    
		} else { // HTML5의 GeoLocation을 사용할 수 없을때 마커 표시 위치와 인포윈도우 내용을 설정합니다
			let message = 'geolocation을 사용할수 없어요..'
			alert(message);
		}
	})//$("img[name='체크포인트']").on("click", function() { 끝
		
	$('input[name="latitudeOfFooter"]').on("change",function(){
		let latitude = $('input[name="latitudeOfFooter"]').val();
		let longitude = $('input[name="longitudeOfFooter"]').val();
		$.ajax("https://dapi.kakao.com/v2/local/geo/coord2address.json",{
			method : "GET",
			dataType : "json",
			headers : {
				"Authorization" : "KakaoAK [[${restKey}]]",
				"Content-type" : "application/json;charset=UTF-8"
			},
			data : {
				x : longitude,
				y : latitude
			},
			success : function(response,status){
				//console.log(response.documents[0].road_address);
				//console.log(response.documents[0].address.address_name);
		    	$('input[name="checkpointAddressOfFooter"]')
		    	.val(response.documents[0].road_address!==null ? response.documents[0].road_address.address_name:response.documents[0].address.address_name)
		    	.trigger('change');
			},
            error: function(xhr, status, error) {
                alert('Error: ' + error);
            }
			
			})
		})//$('input[name="latitudeOfFooter"]').on("change",function(){ 끝
		
		$('input[name="checkpointAddressOfFooter"]').on("change",function(){
			let recordUserId = $('input[name="recordUserIdOfFooter"]').val();
			let latitude = $('input[name="latitudeOfFooter"]').val();
			let longitude = $('input[name="longitudeOfFooter"]').val();
			let checkpointAddress = $('input[name="checkpointAddressOfFooter"]').val();
			$.ajax("/timeline/rest/addTimeline",{
				method : "POST",
				dataType : "json",
				headers : {
					"Content-Type" : "application/json; charset = UTF-8",
					"Accept" : "application/json; charset = UTF-8"
				},
				data : JSON.stringify({
		  		  	recordUserId : recordUserId,
		    		latitude : latitude,
		    		longitude : longitude,
		    		checkpointAddress : checkpointAddress
				}),
				success : function(response,status){
					alert(JSON.stringify(response));
					console.log(JSON.stringify(response));
				},
        		error: function(xhr, status, error) {
            		alert('Error: ' + error);
        		}

			})
		})//$('input[name="checkpointAddressOfFooter"]').on("change",function(){ 끝
			
		
		
		$("div[name='프로필']").on("click", function() {
			window.location.href=`/user/getProfile?userId=${userId}`;
		});
		
		$("div[name='커뮤니티']").on("click", function() {
			window.location.href="/community/getSharedRecordList";
		});
		
		$("div[name='메뉴']").on("click", function() {
			window.location.href="/common/menu";
		});
		
		$("div[name='맵']").on("click", function() {
			window.location.href="/map"
		});
		
		
		$('<link>')
     .appendTo('head')
     .attr({
       type: 'text/css',
       rel: 'stylesheet',
       href: '/css/common/footer.css'
    });	
	});
</script>
</footer>	
</body>

</html>
